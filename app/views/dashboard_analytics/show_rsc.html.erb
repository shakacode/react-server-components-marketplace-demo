<%= stream_react_component_with_async_props("DashboardPageRSC",
    props: { restaurant: @restaurant_data }, prerender: true) do |emit|

  # Stream each section as its query completes — sequential execution
  # avoids PostgreSQL resource contention and ensures each query runs
  # at full speed. The RSC streaming advantage is that each section
  # appears on screen as soon as it's ready (no waiting for ALL data).

  # KPI stats — simple aggregation (~200-500ms)
  emit.call("kpi_stats", Restaurant.dashboard_kpi_stats)

  # Revenue chart — daily aggregation (~500ms-1s)
  emit.call("revenue_data", Restaurant.dashboard_revenue_by_day)

  # Order status — simple GROUP BY (~200-400ms)
  emit.call("order_status", Restaurant.dashboard_order_status)

  # Hourly distribution — hour aggregation (~300-600ms)
  emit.call("hourly_data", Restaurant.dashboard_hourly_distribution)

  # Recent orders — JOIN with order_lines (~300-800ms)
  emit.call("recent_orders", { orders: Restaurant.dashboard_recent_orders })

  # Top menu items — heaviest query (~1-3s)
  emit.call("top_items", { items: Restaurant.dashboard_top_menu_items })
end %>
